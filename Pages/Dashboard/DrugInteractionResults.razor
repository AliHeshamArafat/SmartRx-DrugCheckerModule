@page "/dashboard/drug-interaction-results"
@layout DashboardLayout
@inject NavigationManager Navigation
@inject HttpClient? Http
@inject IJSRuntime? JS

<link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;500;600;700;800&display=swap" rel="stylesheet">

<div class="results-page">
    <!-- Main Content Container -->
    @if (isLoading)
    {
        <div class="results-container" style="text-align: center; padding: 4rem;">
            <div style="font-size: 1.2rem; color: #666;">Loading results...</div>
        </div>
    }
    else if (!string.IsNullOrWhiteSpace(errorMessage))
    {
        <div class="results-container" style="text-align: center; padding: 4rem;">
            <div style="font-size: 1.2rem; color: #EF4444;">@errorMessage</div>
            <button type="button" @onclick="LoadResultsDataAsync" style="margin-top: 1rem; padding: 0.75rem 1.5rem; background: #4994FF; color: white; border: none; border-radius: 8px; cursor: pointer;">
                Retry
            </button>
        </div>
    }
    else
    {
    <div class="results-container">
        <!-- Top Action Bar -->
        <div class="results-navbar">
            <div class="results-navbar-container">
                <button type="button" @onclick="GoBackToForm" class="nav-back-button">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M19 12H5" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                        <path d="M12 19L5 12L12 5" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    </svg>
                    Back to Form
                </button>
                <div class="nav-actions">
                    <button type="button" class="nav-action-button nav-action-secondary">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <path d="M19 21H5C4.46957 21 3.96086 20.7893 3.58579 20.4142C3.21071 20.0391 3 19.5304 3 19V5C3 4.46957 3.21071 3.96086 3.58579 3.58579C3.96086 3.21071 4.46957 3 5 3H16L21 8V19C21 19.5304 20.7893 20.0391 20.4142 20.4142C20.0391 20.7893 19.5304 21 19 21Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                            <path d="M17 21V13H7V21" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                            <path d="M7 3V8H15" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                        </svg>
                        Save Result
                    </button>
                    <button type="button" class="nav-action-button nav-action-primary">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <path d="M19 21H5C4.46957 21 3.96086 20.7893 3.58579 20.4142C3.21071 20.0391 3 19.5304 3 19V5C3 4.46957 3.21071 3.96086 3.58579 3.58579C3.96086 3.21071 4.46957 3 5 3H16L21 8V19C21 19.5304 20.7893 20.0391 20.4142 20.4142C20.0391 20.7893 19.5304 21 19 21Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                            <path d="M17 21V13H7V21" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                            <path d="M7 3V8H15" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                        </svg>
                        Show Arabic Recap
                    </button>
                </div>
            </div>
        </div>
        <!-- Risk Summary Cards -->
        <div class="risk-summary-cards">
            <div class="risk-card risk-card-yellow">
                <div class="risk-card-icon">
                    <img src="images/Documents.png" alt="Same Active Ingredients" />
                </div>
                <div class="risk-card-content">
                    <div class="risk-card-number">@riskSummary.SameActiveIngredients</div>
                    <div class="risk-card-label">Same Active Ingredients</div>
                </div>
            </div>

            <div class="risk-card risk-card-blue">
                <div class="risk-card-icon">
                    <img src="images/Capsule.png" alt="Drug Interactions" />
                </div>
                <div class="risk-card-content">
                    <div class="risk-card-number">@riskSummary.DrugInteractions</div>
                    <div class="risk-card-label">Drug Interactions</div>
                </div>
            </div>

            <div class="risk-card risk-card-orange">
                <div class="risk-card-icon">
                    <img src="images/Baby.png" alt="Pregnancy" />
                </div>
                <div class="risk-card-content">
                    <div class="risk-card-number">@riskSummary.PregnancyRisks</div>
                    <div class="risk-card-label">Pregnancy Risks</div>
                </div>
            </div>

            <div class="risk-card risk-card-purple">
                <div class="risk-card-icon">
                    <img src="images/Heart.png" alt="Lactation Risks" />
                </div>
                <div class="risk-card-content">
                    <div class="risk-card-number">@riskSummary.LactationRisks</div>
                    <div class="risk-card-label">Lactation Risks</div>
                </div>
            </div>

            <div class="risk-card risk-card-red">
                <div class="risk-card-icon">
                    <img src="images/exclamation.png" alt="Contraindications" />
                </div>
                <div class="risk-card-content">
                    <div class="risk-card-number">@riskSummary.Contraindications</div>
                    <div class="risk-card-label">Contraindications</div>
                </div>
            </div>

            <div class="risk-card risk-card-pink">
                <div class="risk-card-icon">
                    <img src="images/Allergy.png" alt="Allergy Risks" />
                </div>
                <div class="risk-card-content">
                    <div class="risk-card-number">@riskSummary.AllergyRisks</div>
                    <div class="risk-card-label">Allergy Risks</div>
                </div>
            </div>
        </div>

        <!-- Overall Risk Banner -->
        <div class="overall-risk-banner">
            <div class="risk-banner-icon">
                <img src="images/WarningYellow.png" alt="Warning" />
            </div>
            <div class="risk-banner-content">
                <div class="risk-banner-title">Overall Risk: @overallRisk.Level</div>
                <div class="risk-banner-message">@overallRisk.InteractionsCount potential interactions detected. Review the details below and consider adjusting the medication regimen.</div>
            </div>
        </div>

        <!-- Detailed Risk Sections -->
        <div class="risk-sections">
            @if (riskSummary.SameActiveIngredients > 0)
            {
                <div class="risk-section risk-section-yellow">
                    <div class="risk-section-header">
                        <div class="risk-section-icon">
                            <img src="images/Documents.png" alt="Same Active Ingredients" />
                        </div>
                        <h3 class="risk-section-title">Same Active Ingredients (@riskSummary.SameActiveIngredients)</h3>
                    </div>
                        @foreach (var item in sameActiveIngredients)
                        {
                            <div class="ingredient-conflict">
                                <div class="drug-pair">
                                    <div class="drug-item">
                                        <div class="drug-name">@item.Drug1.Name</div>
                                        <div class="drug-generic">(@item.Drug1.GenericName)</div>
                                    </div>
                                    <div class="drug-separator">
                                        <div class="drug-separator-icon">
                                            <img src="images/TriangleAlert.png" alt="Same Active Ingredients" />
                                        </div>
                                    </div>
                                    <div class="drug-item">
                                        <div class="drug-name">@item.Drug2.Name</div>
                                        <div class="drug-generic">(@item.Drug2.GenericName)</div>
                                    </div>
                                </div>
                                <div class="conflict-details">
                                    <div class="conflict-details-container">
                                        <span class="conflict-label">Conflicting Ingredients:</span>
                                        <span class="conflict-ingredients">@string.Join(", ", item.ConflictingIngredients)</span>
                                    </div>
                                </div>
                            </div>
                        }
                </div>
            }

            @if (riskSummary.DrugInteractions > 0)
            {
                <div class="risk-section risk-section-blue">
                    <div class="risk-section-header">
                        <div class="risk-section-icon">
                            <img src="images/Capsule.png" alt="Drug Interactions" />
                        </div>
                        <h3 class="risk-section-title">Drug Interactions (@riskSummary.DrugInteractions)</h3>
                    </div>
                    <div class="risk-section-content">
                        @foreach (var interaction in drugInteractions)
                        {
                            <div class="interaction-item">
                                <div class="drug-pair">
                                    <div class="drug-item">
                                        <div class="drug-name">@interaction.Drug1.Name</div>
                                        <div class="drug-generic">(@interaction.Drug1.GenericName)</div>
                                    </div>
                                    <div class="drug-separator">
                                        <img src="images/RightLeftArrow.png" alt="Interaction" />
                                    </div>
                                    <div class="drug-item">
                                        <div class="drug-name">@interaction.Drug2.Name</div>
                                        <div class="drug-generic">(@interaction.Drug2.GenericName)</div>
                                    </div>
                                </div>
                                <div class="interaction-details">
                                    <div class="interaction-details-container">
                                        <div class="severity-container">
                                            <span class="severity-label">Severity:</span>
                                            <span class="severity-badge severity-@interaction.Severity.ToLower().Replace(" ", "-")">@interaction.Severity</span>
                                        </div>
                                        <div class="description-container">
                                            <span class="description-label">Description:</span>
                                            <span class="description-value">@interaction.Description</span>
                                        </div>
                                        <a href="#" class="read-more-link">
                                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                                <path d="M13.828 10.172a4 4 0 0 0-5.656 0l-4 4a4 4 0 1 0 5.656 5.656l1.102-1.101m-.758-4.899a4 4 0 0 0 5.656 0l4-4a4 4 0 0 0-5.656-5.656l-1.1 1.1" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                            </svg>
                                            Read More
                                        </a>
                                    </div>
                                </div>
                            </div>
                        }
                    </div>
                </div>
            }

            @if (riskSummary.PregnancyRisks > 0)
            {
                <div class="risk-section risk-section-orange">
                    <div class="risk-section-header">
                        <div class="risk-section-icon">
                            <img src="images/Baby.png" alt="Pregnancy" />
                        </div>
                        <h3 class="risk-section-title">Pregnancy Risks (@riskSummary.PregnancyRisks)</h3>
                    </div>
                    <div class="risk-section-content">
                        @foreach (var risk in pregnancyRisks)
                        {
                            <div class="pregnancy-risk-item category-@risk.Category.ToLower()">
                                <div class="drug-info">
                                    <div class="drug-name">@risk.Drug.Name</div>
                                    <div class="drug-generic">(@risk.Drug.GenericName)</div>
                                </div>
                                <div class="risk-details-container">
                                    <div class="category-container">
                                        <span class="category-label">Overall Category:</span>
                                        <span class="category-badge category-@risk.Category.ToLower()">@risk.Category</span>
                                    </div>
                                    <p class="risk-description">@risk.Description</p>
                                    @if (risk.TrimesterRisks.Any())
                                    {
                                        <div class="trimester-risks">
                                            <span class="trimester-label">Trimester Specific Risks:</span>
                                            <div class="trimester-badges">
                                                @foreach (var trimester in risk.TrimesterRisks)
                                                {
                                                    <span class="trimester-badge trimester-@trimester.Category.ToLower()">
                                                        @trimester.Trimester: @trimester.Category
                                                    </span>
                                                }
                                            </div>
                                        </div>
                                    }
                                    <a href="#" class="read-more-link">
                                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                            <path d="M13.828 10.172a4 4 0 0 0-5.656 0l-4 4a4 4 0 1 0 5.656 5.656l1.102-1.101m-.758-4.899a4 4 0 0 0 5.656 0l4-4a4 4 0 0 0-5.656-5.656l-1.1 1.1" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                        </svg>
                                        Read More
                                    </a>
                                </div>
                            </div>
                        }
                    </div>
                </div>
            }

            @if (riskSummary.LactationRisks > 0)
            {
                <div class="risk-section risk-section-purple">
                    <div class="risk-section-header">
                        <div class="risk-section-icon">
                            <img src="images/Heart.png" alt="Lactation Risks" />
                        </div>
                        <h3 class="risk-section-title">Lactation Risks (@riskSummary.LactationRisks)</h3>
                    </div>
                    <div class="risk-section-content">
                        @foreach (var risk in lactationRisks)
                        {
                            <div class="lactation-risk-item safety-@risk.SafetyStatus.ToLower().Replace(" ", "-").Replace("'", "")">
                                <div class="drug-info">
                                    <div class="drug-name">@risk.Drug.Name</div>
                                    <div class="drug-generic">(@risk.Drug.GenericName)</div>
                                </div>
                                <div class="risk-details-container">
                                    <div class="safety-status-container">
                                        <span class="safety-status-label">Safety Status:</span>
                                        <span class="safety-badge safety-@risk.SafetyStatus.ToLower().Replace(" ", "-").Replace("'", "")">@risk.SafetyStatus</span>
                                    </div>
                                    <div class="reason-container">
                                        <span class="reason-label">Reason:</span>
                                        <span class="reason-value">@risk.Reason</span>
                                    </div>
                                    <a href="#" class="read-more-link">
                                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                            <path d="M13.828 10.172a4 4 0 0 0-5.656 0l-4 4a4 4 0 1 0 5.656 5.656l1.102-1.101m-.758-4.899a4 4 0 0 0 5.656 0l4-4a4 4 0 0 0-5.656-5.656l-1.1 1.1" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                        </svg>
                                        Read More
                                    </a>
                                </div>
                            </div>
                        }
                    </div>
                </div>
            }

            @if (riskSummary.Contraindications > 0)
            {
                <div class="risk-section risk-section-red">
                    <div class="risk-section-header">
                        <div class="risk-section-icon">
                            <img src="images/exclamation.png" alt="Contraindications" />
                        </div>
                        <h3 class="risk-section-title">Contraindications (@riskSummary.Contraindications)</h3>
                    </div>
                    <div class="risk-section-content">
                        @foreach (var contraindication in contraindications)
                        {
                            <div class="contraindication-item">
                                <div class="drug-info">
                                    <div class="drug-name">@contraindication.Drug.Name</div>
                                    <div class="drug-generic">(@contraindication.Drug.GenericName)</div>
                                </div>
                                <div class="contraindication-details">
                                    <div class="contraindication-info">
                                        <div class="contraindication-row">
                                            <span class="contraindication-label">Contraindicated Condition:</span>
                                            <span class="condition-badge">@contraindication.Condition</span>
                                        </div>
                                        <div class="contraindication-row">
                                            <span class="contraindication-label">Reason:</span>
                                            <p class="contraindication-reason">@contraindication.Reason</p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        }
                    </div>
                </div>
            }

            @if (riskSummary.AllergyRisks > 0)
            {
                <div class="risk-section risk-section-pink">
                    <div class="risk-section-header">
                        <div class="risk-section-icon">
                            <img src="images/Allergy.png" alt="Allergy Risks" />
                        </div>
                        <h3 class="risk-section-title">Hypersensitivity Risks (@riskSummary.AllergyRisks)</h3>
                    </div>
                    <div class="risk-section-content">
                        @foreach (var allergy in allergyRisks)
                        {
                            <div class="allergy-risk-item">
                                <div class="drug-info">
                                    <div class="drug-name">@allergy.Drug.Name</div>
                                    <div class="drug-generic">(@allergy.Drug.GenericName)</div>
                                </div>
                                <div class="allergy-details">
                                    <div class="allergy-info">
                                        <div class="allergy-row">
                                            <span class="allergy-label">Allergen:</span>
                                            <span class="allergen-badge">@allergy.Allergen</span>
                                        </div>
                                        <div class="allergy-row">
                                            <span class="allergy-label">Note:</span>
                                            <p class="allergy-note">@allergy.Note</p>
                                        </div>
                                        <div class="allergy-row">
                                            <span class="allergy-label">Source:</span>
                                            <span class="allergy-source">@allergy.Source</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        }
                    </div>
                </div>
            }
        </div>

        <!-- Key Recommendations -->
        <div class="recommendations-section">
            <div class="recommendations-header">
                <div class="recommendations-icon">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                        <polyline points="22 4 12 14.01 9 11.01" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    </svg>
                </div>
                <h3 class="recommendations-title">Key Recommendations</h3>
            </div>
            <div class="recommendations-list">
                @foreach (var recommendation in keyRecommendations)
                {
                    <div class="recommendation-item">
                        <span class="recommendation-number">@recommendation.Number.</span>
                        <span class="recommendation-text">@recommendation.Text</span>
                    </div>
                }
            </div>
        </div>
    </div>
    }
</div>

<style>
    .results-page {
        min-height: 100vh;
        padding: 0 0 3rem;
        font-family: 'Montserrat', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
        background: transparent;
    }


    .results-navbar-container {
        display: flex;
        align-items: center;
        justify-content: space-between;
        gap: 1.5rem;
        padding: 1rem 1.5rem;
        border-radius: 10px;
        border: 1px solid #DBEAFE;
        background: transparent;
        backdrop-filter: blur(5px);
        -webkit-backdrop-filter: blur(2px);
        box-shadow: 0 10px 30px rgba(15, 23, 42, 0.08);
        box-sizing: border-box;
    }

    .nav-back-button {
        display: flex;
        align-items: center;
        gap: 0.5rem;
        color: #4994FF;
        background-color: transparent;
        border: none;
        font-size: 0.95rem;
        font-family: 'Montserrat', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
        cursor: pointer;
        padding: 0.25rem 0.5rem;
        transition: color 0.3s ease;
    }

    .nav-back-button:hover {
        color: black;
        background: rgba(255, 255, 255, 0.7);
    }

    .nav-back-button svg {
        width: 20px;
        height: 20px;
    }

    .nav-actions {
        display: flex;
        gap: 1rem;
    }

    .nav-action-button {
        display: flex;
        align-items: center;
        gap: 0.5rem;
        border-radius: 10px;
        padding: 0.75rem 1.5rem;
        font-size: 0.95rem;
        font-family: 'Montserrat', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
        cursor: pointer;
        transition: all 0.3s ease;
    }

    .nav-action-primary {
        background: #4994FF;
        color: #ffffff;
        border: 1px solid #4994FF;
    }

    .nav-action-primary:hover {
        background: #357ABD;
        border-color: #357ABD;
        transform: translateY(-1px);
    }

    .nav-action-secondary {
        background: #ffffff;
        color: #4994FF;
        border: 1px solid #4994FF;
    }

    .nav-action-secondary:hover {
        background: rgba(255, 255, 255, 0.9);
        border-color: #357ABD;
        color: #357ABD;
        transform: translateY(-1px);
    }

    .nav-action-button svg {
        width: 20px;
        height: 20px;
    }

    .results-container {
        max-width: 1440px;
        margin: 0 auto 0;
        padding: 0 80px;
    }

    .results-navbar {
        width: 100%;
        margin-bottom: 2rem;
    }

    .risk-summary-cards {
        display: grid;
        grid-template-columns: repeat(3, 1fr);
        gap: 1.5rem;
        margin-bottom: 2rem;
    }

    .risk-card {
        border-radius: 12px;
        padding: 1.5rem;
        display: flex;
        flex-direction: column;
        align-items: center;
        gap: 1rem;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
        border: none;
        border-top: 1px solid;
        transition: transform 0.3s ease;
        backdrop-filter: blur(5px);
        -webkit-backdrop-filter: blur(5px);
    }

    .risk-card:hover {
        transform: translateY(-2px);
    }

    .risk-card-yellow {
        background: linear-gradient(to bottom, rgba(225, 113, 0, 0.0), rgba(225, 113, 0, 0.15));
        border-top-color: #FEF3C6;
    }

    .risk-card-yellow .risk-card-icon {
        background-color: #FEF3C6;
        border-radius: 10px;
    }

    .risk-card-blue {
        background: linear-gradient(to bottom, rgba(60, 144, 255, 0.0), rgba(60, 144, 255, 0.15));
        border-top-color: #DBEAFE;
    }

    .risk-card-blue .risk-card-icon {
        background-color: #DBEAFE;
        border-radius: 10px;
    }

    .risk-card-orange {
        background: linear-gradient(to bottom, rgba(255, 176, 80, 0.0), rgba(255, 176, 80, 0.15));
        border-top-color: #FFEDD4;
    }

    .risk-card-orange .risk-card-icon {
        background-color: #FFEDD4;
        border-radius: 10px;
    }

    .risk-card-purple {
        background: linear-gradient(to bottom, rgba(152, 16, 250, 0.0), rgba(152, 16, 250, 0.15));
        border-top-color: #F3E8FF;
    }

    .risk-card-purple .risk-card-icon {
        background-color: #F3E8FF;
        border-radius: 10px;
    }

    .risk-card-red {
        background: linear-gradient(to bottom, rgba(231, 0, 11, 0.0), rgba(231, 0, 11, 0.15));
        border-top-color: #FFE2E2;
    }

    .risk-card-red .risk-card-icon {
        background-color: #FFE2E2;
        border-radius: 10px;
    }

    .risk-card-pink {
        background: linear-gradient(to bottom, rgba(230, 0, 118, 0.0), rgba(230, 0, 118, 0.15));
        border-top-color: #FCE7F3;
    }

    .risk-card-pink .risk-card-icon {
        background-color: #FCE7F3;
        border-radius: 10px;
    }

    .risk-card-icon {
        width: 40px;
        height: 40px;
        display: flex;
        align-items: center;
        justify-content: center;
        flex-shrink: 0;
    }

    .risk-card-icon svg,
    .risk-card-icon img {
        width: 20px;
        height: 20px;
        object-fit: contain;
    }

    .risk-card-content {
        flex: 1;
        text-align: center;
        width: 100%;
    }

    .risk-card-number {
        font-size: 2rem;
        font-weight: 700;
        color: #333333;
        font-family: 'Montserrat', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
        line-height: 1;
        margin-bottom: 0.25rem;
    }

    .risk-card-label {
        font-size: 0.9rem;
        color: #666666;
        font-family: 'Montserrat', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
    }

    .overall-risk-banner {
        background: linear-gradient(to bottom, rgba(255, 255, 255, 0.9), rgba(255, 176, 80, 0.15));
        border: none;
        border-top: 1px solid #FFEDD4;
        border-radius: 12px;
        padding: 1.5rem;
        margin-bottom: 2rem;
        display: flex;
        align-items: flex-start;
        gap: 1rem;
    }

    .risk-banner-icon {
        width: 56px;
        height: 56px;
        display: flex;
        align-items: center;
        justify-content: center;
        flex-shrink: 0;
        background-color: #FFEDD4;
        border-radius: 8px;
    }

    .risk-banner-icon img {
        width: 28px;
        height: 28px;
        object-fit: contain;
    }

    .risk-banner-content {
        flex: 1;
    }

    .risk-banner-title {
        font-size: 1.25rem;
        font-weight: bold;
        color: #333333;
        margin-bottom: 0.5rem;
        font-family: 'Montserrat', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
    }

    .risk-level {
        font-weight: 700;
    }

    .risk-banner-message {
        font-size: 0.95rem;
        color: #666666;
        font-family: 'Montserrat', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
        line-height: 1.6;
    }

    .risk-sections {
        display: flex;
        flex-direction: column;
        gap: 1.5rem;
        margin-bottom: 2rem;
    }

    .risk-section {
        border-radius: 20px;
        padding: 1.5rem;
        border: 2px solid;
        background: transparent;
        backdrop-filter: blur(5px);
        -webkit-backdrop-filter: blur(5px);
        transition: transform 0.25s ease, box-shadow 0.25s ease, border-color 0.25s ease;
    }

    .risk-section:hover {
        transform: translateY(-4px);
        box-shadow: 0 16px 40px rgba(15, 23, 42, 0.15);
    }

    .risk-section-yellow {
        border-color: #FFB050;
        background: linear-gradient(to bottom, rgba(225, 113, 0, 0.0), rgba(225, 113, 0, 0.1));
    }

    .risk-section-yellow:hover {
        border-color: #E17100;
    }

    .risk-section-blue {
        border: 1.5px solid #DBEAFE;
        background: linear-gradient(to bottom, rgba(73, 148, 255, 0.0), rgba(73, 148, 255, 0.1));
    }

    .risk-section-blue:hover {
        border-color: #4994FF;
    }

    .risk-section-orange {
        border: 1.5px solid #FFEDD4;
        background: linear-gradient(to bottom, rgba(255, 176, 80, 0.0), rgba(255, 176, 80, 0.1));
    }

    .risk-section-orange:hover {
        border-color: #FFB050;
    }

    .risk-section-purple {
        border: 1.5px solid #F3E8FF;
        background: linear-gradient(to bottom, rgba(152, 16, 250, 0.0), rgba(152, 16, 250, 0.1));
    }

    .risk-section-purple:hover {
        border-color: #9810FA;
    }

    .risk-section-red {
        border: 1.5px solid #FFE2E2;
        background: linear-gradient(to bottom, rgba(231, 0, 11, 0.0), rgba(231, 0, 11, 0.1));
    }

    .risk-section-red:hover {
        border-color: #E7000B;
    }

    .risk-section-pink {
        border: 1.5px solid #FCE7F3;
        background: linear-gradient(to bottom, rgba(230, 0, 118, 0.0), rgba(230, 0, 118, 0.1));
    }

    .risk-section-pink:hover {
        border-color: #E60076;
    }

    .risk-section-header {
        display: flex;
        align-items: center;
        gap: 0.75rem;
        margin-bottom: 1.5rem;
    }

    .risk-section-icon {
        width: 40px;
        height: 40px;
        display: flex;
        align-items: center;
        justify-content: center;
        flex-shrink: 0;
        border-radius: 8px;
    }

    .risk-section-yellow .risk-section-icon {
        background-color: #FEF3C6;
    }

    .risk-section-blue .risk-section-icon {
        background-color: #DBEAFE;
    }

    .risk-section-orange .risk-section-icon {
        background-color: #FFEDD4;
    }

    .risk-section-purple .risk-section-icon {
        background-color: #F3E8FF;
    }

    .risk-section-red .risk-section-icon {
        background-color: #FFE2E2;
    }

    .risk-section-pink .risk-section-icon {
        background-color: #FCE7F3;
    }

    .risk-section-icon svg,
    .risk-section-icon img {
        width: 20px;
        height: 20px;
        object-fit: contain;
    }

    .risk-section-title {
        font-size: 1.25rem;
        font-weight: 600;
        color: #333333;
        margin: 0;
        font-family: 'Montserrat', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
    }

    .risk-section-content {
        display: flex;
        flex-direction: column;
        gap: 16px;
        border-radius: 12px;
    }

    .drug-pair {
        display: flex;
        align-items: center;
        gap: 1rem;
        margin-bottom: 1rem;
    }

    .drug-item {
        flex: 1;
        background: #ffffff;
        border-radius: 8px;
        padding: 1rem;
        border: 1px solid #e0e0e0;
    }

    .drug-name {
        font-size: 1rem;
        font-weight: 600;
        color: black;
        margin-bottom: 0.25rem;
        font-family: 'Montserrat', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
    }

    .drug-generic {
        font-size: 0.85rem;
        color: #666666;
        font-family: 'Montserrat', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
    }

    .drug-separator {
        width: 32px;
        height: 32px;
        display: flex;
        align-items: center;
        justify-content: center;
        flex-shrink: 0;
    }

    .drug-separator img {
        width: 17px;
        height: 17px;
        object-fit: contain;
    }

    .ingredient-conflict,
    .interaction-item,
    .pregnancy-risk-item {
        border-radius: 10px;
        padding: 1.5rem;
        border: none;
        border-left: 4px solid #FFB900;
        background-color: #FFFBEB;
    }

    .pregnancy-risk-item.category-a {
        background: #DCFCE7;
        border-left-color: #1DA742;
    }

    .pregnancy-risk-item.category-b {
        background: #EFF6FF;
        border-left-color: #51A2FF;
    }

    .pregnancy-risk-item.category-d {
        background: #FEF2F2;
        border-left-color: #FB2C36;
    }

    .pregnancy-risk-item.category-x {
        background: #FEF2F2;
        border-left-color: #E7000B;
    }

    .lactation-risk-item {
        border-radius: 10px;
        padding: 1.5rem;
        border: none;
        border-left: 4px solid;
    }

    .lactation-risk-item.safety-use-with-caution {
        border-radius: 10px;
        background: #FFF7ED;
        border-left-color: #FF8904;
    }

    .lactation-risk-item.safety-dont-use {
        background: #FEF2F2;
        border-left-color: #E7000B;
    }

    .lactation-risk-item.safety-safely-used {
        background: #DCFCE7;
        border-left-color: #1DA742;
    }

    .contraindication-item {
        background: white;
        border-radius: 10px;
        padding: 1.5rem;
        border-left: 4px solid #FB2C36;
    }

    .allergy-risk-item {
        background: #FDF2F8;
        border-radius: 10px;
        padding: 1.5rem;
        border-left: 4px solid #F6339A;
    }

    .conflict-details {
        margin-top: 1rem;
    }

    .conflict-details-container {
        background: #ffffff;
        border-top: 1px solid #FEE685;
        padding: 1rem;
        border-radius: 8px;
    }

    .conflict-label {
        font-weight: 700;
        font-size: 14px;
        color: #7B3306;
        font-family: 'Montserrat', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
    }

    .conflict-ingredients {
        font-size: 14px;
        font-weight: 500;
        color: #7B3306;
        font-family: 'Montserrat', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
    }

    .interaction-details {
        margin-top: 1rem;
    }

    .interaction-details-container {
        background: #ffffff;
        border: 1px solid #FFD6A7;
        padding: 1rem;
        border-radius: 8px;
        display: flex;
        flex-direction: column;
        gap: 1rem;
    }

    .severity-container {
        display: flex;
        align-items: center;
        gap: 0.5rem;
    }

    .severity-label,
    .description-label {
        font-weight: 600;
        color: #333333;
        font-family: 'Montserrat', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
    }

    .description-value {
        font-weight: 400;
        color: #666666;
        font-family: 'Montserrat', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
    }

    .severity-badge {
        display: inline-block;
        padding: 0.25rem 0.75rem;
        border-radius: 20px;
        font-size: 0.85rem;
        font-weight: 600;
        font-family: 'Montserrat', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
    }

    .severity-monitor-closely {
        background: #FF9800;
        color: white;
        border-radius: 4px;
    }

    .description-container {
        display: flex;
        flex-direction: row;
        align-items: baseline;
        gap: 0.25rem;
        flex-wrap: wrap;
    }

    .interaction-description {
        font-size: 0.95rem;
        color: #666666;
        line-height: 1.6;
        margin: 0;
        font-family: 'Montserrat', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
    }

    .read-more-link {
        display: inline-flex;
        align-items: center;
        gap: 0.5rem;
        color: #4994FF;
        text-decoration: none;
        font-size: 0.9rem;
        font-family: 'Montserrat', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
        margin-top: 0.5rem;
        transition: color 0.3s ease;
    }

    .read-more-link:hover {
        color: #357abd;
    }

    .read-more-link svg {
        width: 16px;
        height: 16px;
    }

    .drug-info {
        margin-bottom: 1rem;
    }

    .risk-details {
        padding-top: 1rem;
    }

    .risk-details-container {
        background: #ffffff;
        padding: 1rem;
        border: 1px solid #FFD6A7;
        border-radius: 8px;
        display: flex;
        flex-direction: column;
    }

    .safety-status-container {
        display: flex;
        align-items: center;
        gap: 0.5rem;
    }

    .safety-status-label,
    .reason-label {
        font-weight: 600;
        color: #333333;
        font-family: 'Montserrat', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
    }

    .reason-container {
        display: flex;
        flex-direction: row;
        align-items: baseline;
        gap: 0.25rem;
        flex-wrap: wrap;
    }

    .reason-value {
        font-weight: 400;
        color: #666666;
        font-family: 'Montserrat', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
    }

    .risk-reason {
        margin: 0;
    }

    .category-container {
        display: flex;
        align-items: center;
        gap: 0.5rem;
        margin-bottom: 0.75rem;
    }

    .category-label {
        font-weight: 600;
        color: #333333;
        font-family: 'Montserrat', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
    }

    .category-badge {
        display: inline-block;
        padding: 0.25rem 0.5rem;
        border-radius: 8px;
        font-size: 12px;
        font-weight: 600;
        font-family: 'Montserrat', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
    }

    .category-a {
        background: #1DA742;
        color: white;
    }

    .category-b {
        background: #2B7FFF;
        color: white;
    }

    .category-c {
        background: #F57F17;
        color: white;
    }

    .category-d {
        background: #E7000B;
        color: white;
    }

    .category-x {
        background: #C10007;
        color: white;
    }

    .risk-description {
        font-size: 0.95rem;
        color: #666666;
        line-height: 1.6;
        margin: 0;
        font-family: 'Montserrat', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
    }

    .trimester-risks {
        margin: 1rem 0;
    }

    .trimester-label {
        font-weight: 600;
        color: #333333;
        font-family: 'Montserrat', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
        display: block;
        margin-bottom: 0.5rem;
    }

    .trimester-badges {
        display: flex;
        gap: 0.5rem;
        flex-wrap: wrap;
    }

    .trimester-badge {
        padding: 0.25rem 0.75rem;
        border-radius: 20px;
        font-size: 0.85rem;
        font-weight: 600;
        font-family: 'Montserrat', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
    }

    .trimester-badge.trimester-c {
        background: #FFF9C4;
        color: #F57F17;
    }

    .trimester-badge.trimester-d {
        background: #FFEBEE;
        color: #C62828;
    }

    .trimester-badge.trimester-x {
        background: #FFEBEE;
        color: #C62828;
    }

    .safety-badge {
        display: inline-block;
        padding: 0.25rem 0.75rem;
        border-radius: 20px;
        font-size: 0.85rem;
        font-weight: 600;
        font-family: 'Montserrat', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
    }

    .safety-use-with-caution {
        border-radius: 4px;
        background: #FFB050;
        color: white;
    }

    .risk-reason {
        font-size: 0.95rem;
        color: #666666;
        line-height: 1.6;
        margin: 0.75rem 0;
        font-family: 'Montserrat', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
    }

    .contraindication-details {
        padding-top: 1rem;
    }

    .contraindication-info {
        background: #ffffff;
        border: 1px solid #FFC9C9;
        border-radius: 10px;
        padding: 1rem;
        display: flex;
        flex-direction: column;
        gap: 0.75rem;
    }

    .contraindication-row {
        display: flex;
        flex-wrap: wrap;
        gap: 0.5rem;
        align-items: center;
    }

    .contraindication-label {
        font-weight: 600;
        color: #333333;
        font-family: 'Montserrat', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
    }

    .condition-badge {
        display: inline-block;
        padding: 0.5rem 1rem;
        border-radius: 8px;
        background: #FFEBEE;
        color: #C62828;
        font-size: 0.95rem;
        font-weight: 600;
        font-family: 'Montserrat', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
    }

    .contraindication-reason {
        font-size: 0.95rem;
        color: #666666;
        line-height: 1.6;
        margin: 0;
        font-family: 'Montserrat', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
    }

    .allergy-details {
        padding-top: 1rem;
    }

    .allergy-info {
        background: #ffffff;
        border: 1px solid #FCCEE8;
        border-radius: 10px;
        padding: 1rem;
        display: flex;
        flex-direction: column;
        gap: 0.75rem;
    }

    .allergy-row {
        display: flex;
        flex-wrap: wrap;
        gap: 0.5rem;
        align-items: center;
    }

    .allergy-label {
        font-weight: 600;
        color: #333333;
        font-family: 'Montserrat', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
    }

    .allergen-badge {
        display: inline-block;
        padding: 0.25rem 0.5rem;
        border-radius: 4px;
        background: #E60076;
        color: white;
        font-size: 0.95rem;
        font-weight: 600;
        font-family: 'Montserrat', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
    }

    .allergy-note {
        font-size: 0.95rem;
        color: #666666;
        line-height: 1.6;
        margin: 0;
        font-family: 'Montserrat', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
    }

    .allergy-source {
        font-size: 0.85rem;
        color: #999999;
        font-style: italic;
        font-family: 'Montserrat', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
    }

    .recommendations-section {
        background: transparent;
        background-image: linear-gradient(to bottom, rgba(255, 255, 255, 0.9), rgba(0, 166, 62, 0.15));
        border: 1.5px solid #B2FFCF;
        border-radius: 12px;
        padding: 1.5rem;
        margin-top: 2rem;
        backdrop-filter: blur(5px);
        -webkit-backdrop-filter: blur(5px);
    }

    .recommendations-header {
        display: flex;
        align-items: center;
        gap: 0.75rem;
        margin-bottom: 1.5rem;
    }

    .recommendations-icon {
        width: 32px;
        height: 32px;
        color: #4CAF50;
        display: flex;
        align-items: center;
        justify-content: center;
    }

    .recommendations-icon svg {
        width: 100%;
        height: 100%;
    }

    .recommendations-title {
        font-size: 1.25rem;
        font-weight: 600;
        color: #333333;
        margin: 0;
        font-family: 'Montserrat', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
    }

    .recommendations-list {
        display: flex;
        flex-direction: column;
        gap: 1rem;
    }

    .recommendation-item {
        display: flex;
        gap: 0.5rem;
        font-size: 0.95rem;
        color: #333333;
        line-height: 1.6;
        font-family: 'Montserrat', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
    }

    .recommendation-number {
        font-weight: 700;
        color: #4CAF50;
    }

    /* Responsive */
    @@media (min-width: 1280px) and (max-width: 1366px) {
        .results-page {
            padding: 0 0 2rem;
        }

        .results-navbar-container,
        .results-container {
            padding: 0 2rem;
            max-width: 1200px;
            margin: 0 auto;
        }

        .risk-summary-cards {
            gap: 1.25rem;
            margin-bottom: 1.5rem;
        }

        .risk-card {
            padding: 1.25rem;
        }

        .risk-card-number {
            font-size: 2rem;
        }

        .risk-card-label {
            font-size: 0.9rem;
        }

        .overall-risk-card {
            padding: 1.25rem;
        }

        .risk-section {
            padding: 1.25rem;
        }

        .risk-section-title {
            font-size: 1.15rem;
        }
    }

    @@media (max-width: 1440px) {
        .results-navbar-container,
        .results-container {
            padding: 0 3rem;
        }
    }

    @@media (max-width: 1024px) {
        .risk-summary-cards {
            grid-template-columns: repeat(2, 1fr);
        }

        .risk-card {
            padding: 1.25rem;
        }

        .risk-card-number {
            font-size: 1.75rem;
        }

        .risk-card-icon {
            width: 36px;
            height: 36px;
        }

        .risk-card-icon svg,
        .risk-card-icon img {
            width: 18px;
            height: 18px;
        }

        .results-navbar-container,
        .results-container {
            padding: 0 2rem;
        }
    }

    @@media (max-width: 768px) {
        .results-page {
            padding: 0.5rem 0 1.5rem;
            min-height: auto;
        }

        .results-container {
            padding: 0 0.75rem;
        }

        .results-navbar {
            height: auto;
            min-height: auto;
            margin-bottom: 1rem;
        }

        .results-navbar-container {
            padding: 0.75rem 1rem;
            gap: 0.75rem;
            flex-direction: column;
            align-items: stretch;
        }

        .nav-back-button {
            font-size: 0.875rem;
            padding: 0.5rem;
        }

        .nav-back-button svg {
            width: 18px;
            height: 18px;
        }

        .nav-actions {
            flex-direction: column;
            gap: 0.5rem;
            width: 100%;
        }

        .nav-action-button {
            width: 100%;
            padding: 0.625rem 1rem;
            font-size: 0.875rem;
            justify-content: center;
        }

        .nav-action-button svg {
            width: 18px;
            height: 18px;
        }

        .risk-summary-cards {
            grid-template-columns: repeat(2, 1fr);
            gap: 0.75rem;
            margin-bottom: 1rem;
        }

        .risk-card {
            padding: 0.75rem;
            gap: 0.5rem;
        }

        .risk-card-icon {
            width: 28px;
            height: 28px;
        }

        .risk-card-icon svg,
        .risk-card-icon img {
            width: 14px;
            height: 14px;
        }

        .risk-card-number {
            font-size: 1.25rem;
        }

        .risk-card-label {
            font-size: 0.7rem;
        }

        .overall-risk-banner {
            padding: 1rem;
            margin-bottom: 1rem;
            gap: 0.75rem;
        }

        .risk-banner-icon {
            width: 40px;
            height: 40px;
        }

        .risk-banner-icon img {
            width: 20px;
            height: 20px;
        }

        .risk-banner-title {
            font-size: 1rem;
            margin-bottom: 0.25rem;
        }

        .risk-banner-message {
            font-size: 0.8rem;
            line-height: 1.4;
        }

        .risk-sections {
            gap: 1rem;
            margin-bottom: 1rem;
        }

        .risk-section {
            padding: 1rem;
            border-radius: 12px;
        }

        .risk-section-header {
            margin-bottom: 1rem;
            gap: 0.5rem;
        }

        .risk-section-icon {
            width: 32px;
            height: 32px;
        }

        .risk-section-icon svg,
        .risk-section-icon img {
            width: 16px;
            height: 16px;
        }

        .risk-section-title {
            font-size: 1rem;
        }

        .risk-section-content {
            gap: 0.75rem;
        }

        .drug-pair {
            flex-direction: column;
            gap: 0.5rem;
            margin-bottom: 0.75rem;
        }

        .drug-item {
            padding: 0.75rem;
        }

        .drug-name {
            font-size: 0.9rem;
        }

        .drug-generic {
            font-size: 0.75rem;
        }

        .drug-separator {
            transform: rotate(90deg);
            width: 24px;
            height: 24px;
        }

        .ingredient-conflict,
        .interaction-item,
        .pregnancy-risk-item,
        .lactation-risk-item,
        .contraindication-item,
        .allergy-risk-item {
            padding: 1rem;
            border-radius: 8px;
        }

        .interaction-details-container,
        .risk-details-container,
        .conflict-details-container,
        .contraindication-info,
        .allergy-info {
            padding: 0.75rem;
            gap: 0.5rem;
        }

        .severity-container,
        .description-container,
        .category-container,
        .safety-status-container,
        .reason-container {
            gap: 0.375rem;
        }

        .severity-label,
        .description-label,
        .category-label,
        .safety-status-label,
        .reason-label {
            font-size: 0.8rem;
        }

        .description-value,
        .reason-value,
        .risk-description {
            font-size: 0.8rem;
            line-height: 1.4;
        }

        .severity-badge,
        .category-badge,
        .safety-badge {
            font-size: 0.7rem;
            padding: 0.2rem 0.5rem;
        }

        .recommendations-section {
            padding: 1rem;
            margin-top: 1rem;
        }

        .recommendations-header {
            margin-bottom: 1rem;
            gap: 0.5rem;
        }

        .recommendations-icon {
            width: 24px;
            height: 24px;
        }

        .recommendations-title {
            font-size: 1rem;
        }

        .recommendations-list {
            gap: 0.75rem;
        }

        .recommendation-item {
            font-size: 0.8rem;
            line-height: 1.4;
        }
    }
</style>

@code {
    // Models
    private class RiskSummary
    {
        public int SameActiveIngredients { get; set; }
        public int DrugInteractions { get; set; }
        public int PregnancyRisks { get; set; }
        public int LactationRisks { get; set; }
        public int Contraindications { get; set; }
        public int AllergyRisks { get; set; }
    }

    private class OverallRisk
    {
        public string Level { get; set; } = "";
        public int InteractionsCount { get; set; }
    }

    private class Drug
    {
        public string Name { get; set; } = "";
        public string GenericName { get; set; } = "";
    }

    private class IngredientConflict
    {
        public Drug Drug1 { get; set; } = new();
        public Drug Drug2 { get; set; } = new();
        public List<string> ConflictingIngredients { get; set; } = new();
    }

    private class DrugInteraction
    {
        public Drug Drug1 { get; set; } = new();
        public Drug Drug2 { get; set; } = new();
        public string Severity { get; set; } = "";
        public string Description { get; set; } = "";
    }

    private class PregnancyRisk
    {
        public Drug Drug { get; set; } = new();
        public string Category { get; set; } = "";
        public string Description { get; set; } = "";
        public List<TrimesterRisk> TrimesterRisks { get; set; } = new();
    }

    private class TrimesterRisk
    {
        public string Trimester { get; set; } = "";
        public string Category { get; set; } = "";
    }

    private class LactationRisk
    {
        public Drug Drug { get; set; } = new();
        public string SafetyStatus { get; set; } = "";
        public string Reason { get; set; } = "";
    }

    private class Contraindication
    {
        public Drug Drug { get; set; } = new();
        public string Condition { get; set; } = "";
        public string Reason { get; set; } = "";
    }

    private class AllergyRisk
    {
        public Drug Drug { get; set; } = new();
        public string Allergen { get; set; } = "";
        public string Note { get; set; } = "";
        public string Source { get; set; } = "";
    }

    private class Recommendation
    {
        public int Number { get; set; }
        public string Text { get; set; } = "";
    }

    // Data properties
    private RiskSummary riskSummary = new();
    private OverallRisk overallRisk = new();
    private List<IngredientConflict> sameActiveIngredients = new();
    private List<DrugInteraction> drugInteractions = new();
    private List<PregnancyRisk> pregnancyRisks = new();
    private List<LactationRisk> lactationRisks = new();
    private List<Contraindication> contraindications = new();
    private List<AllergyRisk> allergyRisks = new();
    private List<Recommendation> keyRecommendations = new();
    
    private bool isLoading = true;
    private string? errorMessage;

    protected override async Task OnInitializedAsync()
    {
        await LoadResultsDataAsync();
    }

    private async Task LoadResultsDataAsync()
    {
        isLoading = true;
        errorMessage = null;
        StateHasChanged();

        try
        {
            // TODO: Replace with actual API endpoint
            // Option 1: Get from session storage if passed from previous page
            // var resultsJson = await JS.InvokeAsync<string>("sessionStorage.getItem", "drugCheckResults");
            // if (!string.IsNullOrWhiteSpace(resultsJson))
            // {
            //     var results = JsonSerializer.Deserialize<DrugInteractionResultsResponse>(resultsJson);
            //     if (results != null)
            //     {
            //         MapResultsToModels(results);
            //         isLoading = false;
            //         StateHasChanged();
            //         return;
            //     }
            // }

            // Option 2: Get from API using check ID from query string
            // var uri = Navigation.ToAbsoluteUri(Navigation.Uri);
            // var checkId = QueryHelpers.ParseQuery(uri.Query).TryGetValue("checkId", out var id) ? id.ToString() : null;
            // if (!string.IsNullOrWhiteSpace(checkId))
            // {
            //     var response = await Http.GetFromJsonAsync<DrugInteractionResultsResponse>($"/api/drug-interaction/results/{checkId}");
            //     if (response != null)
            //     {
            //         MapResultsToModels(response);
            //         isLoading = false;
            //         StateHasChanged();
            //         return;
            //     }
            // }

            // Fallback to mock data for now
            await Task.Delay(500); // Simulate API delay
            LoadMockData();
        }
        catch (Exception ex)
        {
            // TODO: Add proper error handling/logging
            errorMessage = $"Error loading results: {ex.Message}";
            Console.WriteLine(errorMessage);
            // Fallback to mock data on error
            LoadMockData();
        }
        finally
        {
            isLoading = false;
            StateHasChanged();
        }
    }

    // Helper method to map API response to UI models
    // private void MapResultsToModels(DrugInteractionResultsResponse response)
    // {
    //     riskSummary = response.RiskSummary ?? new RiskSummary();
    //     overallRisk = response.OverallRisk ?? new OverallRisk();
    //     sameActiveIngredients = response.SameActiveIngredients ?? new List<IngredientConflict>();
    //     drugInteractions = response.DrugInteractions ?? new List<DrugInteraction>();
    //     pregnancyRisks = response.PregnancyRisks ?? new List<PregnancyRisk>();
    //     lactationRisks = response.LactationRisks ?? new List<LactationRisk>();
    //     contraindications = response.Contraindications ?? new List<Contraindication>();
    //     allergyRisks = response.AllergyRisks ?? new List<AllergyRisk>();
    //     keyRecommendations = response.KeyRecommendations ?? new List<Recommendation>();
    // }

    private void LoadMockData()
    {
        // Mock risk summary
        riskSummary = new RiskSummary
        {
            SameActiveIngredients = 1,
            DrugInteractions = 3,
            PregnancyRisks = 5,
            LactationRisks = 5,
            Contraindications = 1,
            AllergyRisks = 2
        };

        // Mock overall risk
        overallRisk = new OverallRisk
        {
            Level = "Moderate",
            InteractionsCount = 3
        };

        // Mock same active ingredients
        sameActiveIngredients = new List<IngredientConflict>
        {
            new IngredientConflict
            {
                Drug1 = new Drug { Name = "Amoxicillin - October Pharma 500 Mg 12 Capsules", GenericName = "Amoxicillin" },
                Drug2 = new Drug { Name = "Augmentin 1000 Mg 14 F.C Tablets", GenericName = "Amoxicillin, Clavulanic Acid" },
                ConflictingIngredients = new List<string> { "Amoxicillin" }
            }
        };

        // Mock drug interactions
        drugInteractions = new List<DrugInteraction>
        {
            new DrugInteraction
            {
                Drug1 = new Drug { Name = "Amoxicillin - October Pharma 500 Mg 12 Capsules", GenericName = "Amoxicillin" },
                Drug2 = new Drug { Name = "Warfarin B.P. 2003 2 Mg 30 Tablets", GenericName = "Warfarin" },
                Severity = "Monitor Closely",
                Description = "Amoxicillin may enhance anticoagulant effect of vitamin k antagonists."
            },
            new DrugInteraction
            {
                Drug1 = new Drug { Name = "Augmentin 1000 Mg 14 F.C Tablets", GenericName = "Amoxicillin, Clavulanic Acid" },
                Drug2 = new Drug { Name = "Warfarin B.P. 2003 2 Mg 30 Tablets", GenericName = "Warfarin" },
                Severity = "Monitor Closely",
                Description = "Amoxicillin may enhance anticoagulant effect of vitamin k antagonists."
            },
            new DrugInteraction
            {
                Drug1 = new Drug { Name = "Brufen 600 Mg 10 Effervescent Sachet", GenericName = "Ibuprofen" },
                Drug2 = new Drug { Name = "Warfarin B.P. 2003 2 Mg 30 Tablets", GenericName = "Warfarin" },
                Severity = "Monitor Closely",
                Description = "Ibuprofen increases the anticoagulation effect of warfarin. Monitor therapy and adjust as needed."
            }
        };

        // Mock pregnancy risks
        pregnancyRisks = new List<PregnancyRisk>
        {
            new PregnancyRisk
            {
                Drug = new Drug { Name = "Amoxicillin - October Pharma 500 Mg 12 Capsules", GenericName = "Amoxicillin" },
                Category = "B",
                Description = "May be acceptable. Either animal studies show no risk but human studies not available or animal studies showed minor risks and human studies done and showed no risk."
            },
            new PregnancyRisk
            {
                Drug = new Drug { Name = "Augmentin 1000 Mg 14 F.C Tablets", GenericName = "Amoxicillin" },
                Category = "B",
                Description = "May be acceptable. Either animal studies show no risk but human studies not available or animal studies showed minor risks and human studies done and showed no risk."
            },
            new PregnancyRisk
            {
                Drug = new Drug { Name = "Augmentin 1000 Mg 14 F.C Tablets", GenericName = "Clavulanic Acid" },
                Category = "B",
                Description = "May be acceptable. Either animal studies show no risk but human studies not available or animal studies showed minor risks and human studies done and showed no risk."
            },
            new PregnancyRisk
            {
                Drug = new Drug { Name = "Brufen 600 Mg 10 Effervescent Sachet", GenericName = "Ibuprofen" },
                Category = "D",
                Description = "Use in LIFE-THREATENING emergencies when no safer drug available. Positive evidence of human fetal risk.",
                TrimesterRisks = new List<TrimesterRisk>
                {
                    new TrimesterRisk { Trimester = "1st Trimester", Category = "C" },
                    new TrimesterRisk { Trimester = "2nd Trimester", Category = "D" },
                    new TrimesterRisk { Trimester = "3rd Trimester", Category = "D" }
                }
            },
            new PregnancyRisk
            {
                Drug = new Drug { Name = "Warfarin B.P. 2003 2 Mg 30 Tablets", GenericName = "Warfarin" },
                Category = "X",
                Description = "Do not use in pregnancy. Risks involved outweigh potential benefits. Safer alternatives exist.",
                TrimesterRisks = new List<TrimesterRisk>
                {
                    new TrimesterRisk { Trimester = "1st Trimester", Category = "X" },
                    new TrimesterRisk { Trimester = "2nd Trimester", Category = "D" },
                    new TrimesterRisk { Trimester = "3rd Trimester", Category = "D" }
                }
            }
        };

        // Mock lactation risks
        lactationRisks = new List<LactationRisk>
        {
            new LactationRisk
            {
                Drug = new Drug { Name = "Amoxicillin - October Pharma 500 Mg 12 Capsules", GenericName = "Amoxicillin" },
                SafetyStatus = "Use With Caution",
                Reason = "Present in human milk; may cause diarrhea in breastfed infant."
            },
            new LactationRisk
            {
                Drug = new Drug { Name = "Augmentin 1000 Mg 14 F.C Tablets", GenericName = "Amoxicillin" },
                SafetyStatus = "Use With Caution",
                Reason = "Present in human milk; may cause diarrhea in breastfed infant."
            },
            new LactationRisk
            {
                Drug = new Drug { Name = "Brufen 600 Mg 10 Effervescent Sachet", GenericName = "Ibuprofen" },
                SafetyStatus = "Use With Caution",
                Reason = "Present in human milk at 0.06-0.0% of maternal dose."
            },
            new LactationRisk
            {
                Drug = new Drug { Name = "Warfarin B.P. 2003 2 Mg 30 Tablets", GenericName = "Warfarin" },
                SafetyStatus = "Use With Caution",
                Reason = "Monitor for bruising or bleeding in breastfed infants."
            }
        };

        // Mock contraindications
        contraindications = new List<Contraindication>
        {
            new Contraindication
            {
                Drug = new Drug { Name = "Brufen 600 Mg 10 Effervescent Sachet", GenericName = "Ibuprofen" },
                Condition = "Gastric Ulcer",
                Reason = "These conditions can occur without warning while you are using this medicine, especially in older adults."
            }
        };

        // Mock allergy risks
        allergyRisks = new List<AllergyRisk>
        {
            new AllergyRisk
            {
                Drug = new Drug { Name = "Amoxicillin - October Pharma 500 Mg 12 Capsules", GenericName = "Amoxicillin" },
                Allergen = "Amoxicillin",
                Note = "Known allergy (entered in drug checker)",
                Source = "Known Allergy (User Input)"
            },
            new AllergyRisk
            {
                Drug = new Drug { Name = "Augmentin 1000 Mg 14 F.C Tablets", GenericName = "Amoxicillin, Clavulanic Acid" },
                Allergen = "Amoxicillin",
                Note = "Known allergy (entered in drug checker)",
                Source = "Known Allergy (User Input)"
            }
        };

        // Mock recommendations
        keyRecommendations = new List<Recommendation>
        {
            new Recommendation { Number = 1, Text = "Avoid combination of Warfarin and Ibuprofen. Consider acetaminophen as an alternative for pain management." },
            new Recommendation { Number = 2, Text = "Monitor INR closely during and after Amoxicillin therapy due to potential interaction with Warfarin." },
            new Recommendation { Number = 3, Text = "Consider alternative anticoagulation for pregnant patients currently on Warfarin." },
            new Recommendation { Number = 4, Text = "Monitor kidney function and blood glucose in diabetic patient using Ibuprofen." }
        };
    }

    private void GoBackToForm()
    {
        Navigation.NavigateTo("/dashboard/drug-checker");
    }
}
