@page "/dashboard/settings"
@layout DashboardLayout
@inject NavigationManager Navigation

<link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;500;600;700;800&display=swap" rel="stylesheet">

<div class="settings-page">
    <!-- Header Section -->
    <div class="settings-header-container">
        <div class="settings-header">
            <div class="settings-header-left">
                <h1 class="settings-title">Professional Profile</h1>
            </div>
        </div>
    </div>

    <!-- Profile Section -->
    <div class="settings-section">
        <h2 class="section-title">Profile</h2>
        <div class="form-group">
            <label class="form-label">Avatar</label>
            <div class="profile-avatar-section">
                <div class="avatar-placeholder">
                    <svg width="32" height="32" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" class="avatar-icon">
                        <path d="M20 21V19C20 17.9391 19.5786 16.9217 18.8284 16.1716C18.0783 15.4214 17.0609 15 16 15H8C6.93913 15 5.92172 15.4214 5.17157 16.1716C4.42143 16.9217 4 17.9391 4 19V21" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                        <path d="M12 11C14.2091 11 16 9.20914 16 7C16 4.79086 14.2091 3 12 3C9.79086 3 8 4.79086 8 7C8 9.20914 9.79086 11 12 11Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    </svg>
                </div>
                <button type="button" class="upload-btn" @onclick="HandleUploadAvatar">Upload</button>
            </div>
        </div>
        <div class="form-group">
            <label class="form-label">Name</label>
            <input type="text" @bind="profileData.Name" class="form-input" placeholder="Enter your name" />
        </div>
        <div class="form-group">
            <label class="form-label">Email</label>
            <input type="email" @bind="profileData.Email" class="form-input" />
        </div>
        <div class="form-group">
            <label class="form-label">Phone Number</label>
            <input type="tel" @bind="profileData.PhoneNumber" class="form-input" placeholder="Enter your phone number" />
        </div>

        <!-- Additional Fields Accordion -->
        <div class="profile-accordion">
            <button type="button" class="accordion-header" @onclick="ToggleAdditionalFields">
                <span class="accordion-title">Additional Information</span>
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" class="accordion-icon @(isAdditionalFieldsExpanded ? "expanded" : "")">
                    <path d="M6 9L12 15L18 9" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                </svg>
            </button>
            @if (isAdditionalFieldsExpanded)
            {
                <div class="accordion-content">
                    <div class="form-group">
                        <label class="form-label">Username</label>
                        <input type="text" @bind="profileData.Username" class="form-input" />
                    </div>
                    <div class="form-group">
                        <label class="form-label">Speciality</label>
                        <input type="text" @bind="profileData.Speciality" class="form-input" placeholder="Enter your speciality" />
                    </div>
                    <div class="form-group">
                        <label class="form-label">Professional Title</label>
                        <input type="text" @bind="profileData.ProfessionalTitle" class="form-input" placeholder="Enter your professional title" />
                    </div>
                    <div class="form-group">
                        <label class="form-label">Organization</label>
                        <input type="text" @bind="profileData.Organization" class="form-input" placeholder="Enter your organization" />
                    </div>
                    <div class="form-group">
                        <label class="form-label">Address</label>
                        <input type="text" @bind="profileData.Address" class="form-input" placeholder="Enter your address" />
                    </div>
                    <div class="form-group">
                        <label class="form-label">Map Location</label>
                        <div class="map-location-container">
                            <input type="text" @bind="profileData.MapLocation" class="form-input" placeholder="Enter map location or coordinates" />
                            <button type="button" class="map-location-btn" @onclick="OpenMapPicker" title="Pick location on map">
                                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                    <path d="M21 10C21 17 12 23 12 23C12 23 3 17 3 10C3 7.61305 3.94821 5.32387 5.63604 3.63604C7.32387 1.94821 9.61305 1 12 1C14.3869 1 16.6761 1.94821 18.364 3.63604C20.0518 5.32387 21 7.61305 21 10Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                    <circle cx="12" cy="10" r="3" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                </svg>
                            </button>
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="form-label">About</label>
                        <textarea @bind="profileData.About" class="form-textarea" placeholder="Tell us about yourself..." rows="4"></textarea>
                    </div>
                </div>
            }
        </div>
    </div>

    <!-- Security Section -->
    <div class="settings-section">
        <h2 class="section-title">Security</h2>
        <div class="security-item">
            <label class="form-label">Password</label>
            <div class="security-content">
                <p class="security-description">Update your password through the button below. A modal will open where you can change your password securely.</p>
                <button type="button" class="set-password-btn" @onclick="HandleSetPassword">Set new password</button>
            </div>
        </div>
        <div class="security-item">
            <label class="form-label">Two-factor authentication</label>
            <div class="security-content">
                <p class="security-description">Enable two-factor authentication to add an extra layer of security to your account. When you log in, we'll send a 6-digit code to your email that you'll have to enter to verify it's you.</p>
                <label class="toggle-switch">
                    <input type="checkbox" @bind="profileData.TwoFactorEnabled" />
                    <span class="toggle-slider"></span>
                </label>
            </div>
        </div>
    </div>

    <!-- Connected Accounts Section -->
    <div class="settings-section">
        <h2 class="section-title">Connected accounts</h2>
        <p class="section-description">Manage the social media accounts connected to your profile for easy login.</p>
        <div class="connected-account-item">
            <div class="account-info">
                <div class="account-logo">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M22.56 12.25C22.56 11.47 22.49 10.72 22.36 10H12V14.51H17.92C17.66 15.98 16.88 17.24 15.71 18.09V21.09H19.28C21.36 19.16 22.56 16.04 22.56 12.25Z" fill="#4285F4"/>
                        <path d="M12 23C15.24 23 17.95 21.93 19.28 19.09L15.71 16.09C14.73 16.72 13.48 17.11 12 17.11C8.87 17.11 6.22 14.96 5.28 12.11H1.55V15.16C2.89 17.89 5.61 20 12 20Z" fill="#34A853"/>
                        <path d="M5.28 12.11C5.03 11.31 4.89 10.47 4.89 9.61C4.89 8.75 5.03 7.91 5.27 7.11V4.06H1.55C0.68 5.83 0.11 7.89 0.11 9.61C0.11 11.33 0.68 13.39 1.55 15.16L5.28 12.11Z" fill="#FBBC05"/>
                        <path d="M12 5.89C13.62 5.89 15.06 6.38 16.21 7.32L19.36 4.17C17.95 2.92 15.24 2 12 2C5.61 2 2.89 4.11 1.55 6.84L5.28 9.89C6.22 7.04 8.87 4.89 12 4.89Z" fill="#EA4335"/>
                    </svg>
                </div>
                <div class="account-details">
                    <span class="account-name">Google</span>
                    <span class="account-status">Connected</span>
                </div>
            </div>
            <button type="button" class="disconnect-btn" @onclick="HandleDisconnectGoogle">Disconnect</button>
        </div>
    </div>

    <!-- Sessions & Devices Section -->
    <div class="settings-section">
        <div class="sessions-header">
            <div class="sessions-header-left">
                <h2 class="section-title">Sessions & devices</h2>
                <div class="info-text">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" class="info-icon">
                        <circle cx="12" cy="12" r="10" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                        <path d="M12 16V12M12 8H12.01" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    </svg>
                    <span>For security reasons, each account is limited to three connected devices.</span>
                </div>
            </div>
            <span class="device-count">@connectedDevices.Count/@maxDevices devices</span>
        </div>
        <div class="devices-table-container">
            <table class="devices-table">
                <thead>
                    <tr>
                        <th>OS</th>
                        <th>Browser</th>
                        <th>Location</th>
                        <th>Last session</th>
                        <th></th>
                    </tr>
                </thead>
                <tbody>
                    @foreach (var device in connectedDevices)
                    {
                        <tr>
                            <td>@device.OS</td>
                            <td>@device.Browser</td>
                            <td>@device.Location</td>
                            <td>
                                @if (device.IsCurrentDevice)
                                {
                                    <span class="current-device-badge">â€¢ This device</span>
                                }
                                else
                                {
                                    <span>@device.LastSession</span>
                                }
                            </td>
                            <td>
                                @if (!device.IsCurrentDevice)
                                {
                                    <button type="button" class="delete-device-btn" @onclick="() => HandleDeleteDevice(device)">
                                        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                            <path d="M3 6H5H21M8 6V4C8 3.46957 8.21071 2.96086 8.58579 2.58579C8.96086 2.21071 9.46957 2 10 2H14C14.5304 2 15.0391 2.21071 15.4142 2.58579C15.7893 2.96086 16 3.46957 16 4V6M19 6V20C19 20.5304 18.7893 21.0391 18.4142 21.4142C18.0391 21.7893 17.5304 22 17 22H7C6.46957 22 5.96086 21.7893 5.58579 21.4142C5.21071 21.0391 5 20.5304 5 20V6H19Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                            <path d="M10 11V17M14 11V17" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                        </svg>
                                    </button>
                                }
                            </td>
                        </tr>
                    }
                </tbody>
            </table>
        </div>
    </div>

    <!-- Delete Account Section -->
    <div class="settings-section delete-account-section">
        <button type="button" class="delete-account-btn" disabled>Delete Account</button>
        <p class="delete-account-note">
            Note: As you have an active paid plan, you can't delete your account directly. Please contact 
            <a href="mailto:support@smartrx.com" class="support-link">support@smartrx.com</a> for assistance.
        </p>
    </div>
</div>

<!-- Change Password Modal -->
@if (isPasswordModalOpen)
{
    <div class="password-modal-backdrop" @onclick="ClosePasswordModal">
        <div class="password-modal" @onclick:stopPropagation="true">
            <div class="password-modal-header">
                <h2 class="password-modal-title">Change Your Password</h2>
                <button type="button" class="password-modal-close" @onclick="ClosePasswordModal">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M18 6L6 18" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
                        <path d="M6 6L18 18" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
                    </svg>
                </button>
            </div>

            <div class="password-modal-body">
                <!-- Disclaimer Container -->
                <div class="password-disclaimer">
                    <p class="password-disclaimer-text">For your security, please enter your current password and choose a new strong password.</p>
                </div>

                <!-- Password Form -->
                <form class="password-form" @onsubmit="HandleChangePassword" @onsubmit:preventDefault="true">
                    <div class="password-form-group">
                        <label class="password-form-label">Current Password <span class="required-asterisk">*</span></label>
                        <div class="password-input-wrapper">
                            <input type="@(showCurrentPassword ? "text" : "password")" 
                                   @bind="passwordData.CurrentPassword" 
                                   class="password-form-input" 
                                   placeholder="Enter current password" 
                                   required />
                            <button type="button" class="password-toggle-btn" @onclick="() => showCurrentPassword = !showCurrentPassword">
                                @if (showCurrentPassword)
                                {
                                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                        <path d="M1 12S5 4 12 4S23 12 23 12S19 20 12 20S1 12 1 12Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                        <circle cx="12" cy="12" r="3" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                    </svg>
                                }
                                else
                                {
                                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                        <path d="M17.94 17.94A10.07 10.07 0 0 1 12 20C7 20 2.73 16.39 1 12C2.73 7.61 7 4 12 4C13.83 4 15.5 4.5 16.94 5.36L17.94 4.36M19.07 3.07L20.07 2.07M1 1L5.94 5.94M22 22L17.06 17.06" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                        <path d="M9.9 4.24A9.12 9.12 0 0 1 12 4C17 4 21.27 7.61 23 12C22.19 14.11 20.79 15.85 19.07 17.07L9.9 4.24Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                        <path d="M14.1 19.76A9.12 9.12 0 0 1 12 20C7 20 2.73 16.39 1 12C1.81 9.89 3.21 8.15 4.93 6.93L14.1 19.76Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                    </svg>
                                }
                            </button>
                        </div>
                    </div>

                    <div class="password-form-group">
                        <label class="password-form-label">New Password <span class="required-asterisk">*</span></label>
                        <div class="password-input-wrapper @(HasNewPasswordErrors() || IsNewPasswordSameAsCurrent() ? "invalid" : "")">
                            <input type="@(showNewPassword ? "text" : "password")" 
                                   @bind="passwordData.NewPassword" 
                                   @bind:event="oninput"
                                   class="password-form-input" 
                                   placeholder="Enter new password" 
                                   required />
                            <button type="button" class="password-toggle-btn" @onclick="() => showNewPassword = !showNewPassword">
                                @if (showNewPassword)
                                {
                                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                        <path d="M1 12S5 4 12 4S23 12 23 12S19 20 12 20S1 12 1 12Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                        <circle cx="12" cy="12" r="3" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                    </svg>
                                }
                                else
                                {
                                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                        <path d="M17.94 17.94A10.07 10.07 0 0 1 12 20C7 20 2.73 16.39 1 12C2.73 7.61 7 4 12 4C13.83 4 15.5 4.5 16.94 5.36L17.94 4.36M19.07 3.07L20.07 2.07M1 1L5.94 5.94M22 22L17.06 17.06" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                        <path d="M9.9 4.24A9.12 9.12 0 0 1 12 4C17 4 21.27 7.61 23 12C22.19 14.11 20.79 15.85 19.07 17.07L9.9 4.24Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                        <path d="M14.1 19.76A9.12 9.12 0 0 1 12 20C7 20 2.73 16.39 1 12C1.81 9.89 3.21 8.15 4.93 6.93L14.1 19.76Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                    </svg>
                                }
                            </button>
                        </div>
                        @if (!string.IsNullOrWhiteSpace(passwordData.NewPassword) && IsNewPasswordSameAsCurrent())
                        {
                            <div class="password-validation-message">
                                New password cannot be the same as your current password
                            </div>
                        }
                        @if (!string.IsNullOrWhiteSpace(passwordData.NewPassword))
                        {
                            <div class="password-validation-list">
                                <div class="password-validation-item @(HasMinLength() ? "valid" : "invalid")">
                                    @if (HasMinLength())
                                    {
                                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                            <path d="M20 6L9 17L4 12" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                        </svg>
                                    }
                                    else
                                    {
                                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                            <circle cx="12" cy="12" r="10" stroke="currentColor" stroke-width="2"/>
                                            <path d="M12 8V12M12 16H12.01" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                                        </svg>
                                    }
                                    <span>At least 8 characters</span>
                                </div>
                                <div class="password-validation-item @(HasCapitalLetter() ? "valid" : "invalid")">
                                    @if (HasCapitalLetter())
                                    {
                                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                            <path d="M20 6L9 17L4 12" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                        </svg>
                                    }
                                    else
                                    {
                                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                            <circle cx="12" cy="12" r="10" stroke="currentColor" stroke-width="2"/>
                                            <path d="M12 8V12M12 16H12.01" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                                        </svg>
                                    }
                                    <span>1 capital letter</span>
                                </div>
                                <div class="password-validation-item @(HasSpecialCharacter() ? "valid" : "invalid")">
                                    @if (HasSpecialCharacter())
                                    {
                                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                            <path d="M20 6L9 17L4 12" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                        </svg>
                                    }
                                    else
                                    {
                                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                            <circle cx="12" cy="12" r="10" stroke="currentColor" stroke-width="2"/>
                                            <path d="M12 8V12M12 16H12.01" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                                        </svg>
                                    }
                                    <span>1 special character</span>
                                </div>
                            </div>
                        }
                    </div>

                    <div class="password-form-group">
                        <label class="password-form-label">Confirm New Password <span class="required-asterisk">*</span></label>
                        <div class="password-input-wrapper @(HasPasswordMismatch() ? "invalid" : "")">
                            <input type="@(showConfirmPassword ? "text" : "password")" 
                                   @bind="passwordData.ConfirmPassword" 
                                   @bind:event="oninput"
                                   class="password-form-input" 
                                   placeholder="Confirm new password" 
                                   required />
                            <button type="button" class="password-toggle-btn" @onclick="() => showConfirmPassword = !showConfirmPassword">
                                @if (showConfirmPassword)
                                {
                                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                        <path d="M1 12S5 4 12 4S23 12 23 12S19 20 12 20S1 12 1 12Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                        <circle cx="12" cy="12" r="3" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                    </svg>
                                }
                                else
                                {
                                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                        <path d="M17.94 17.94A10.07 10.07 0 0 1 12 20C7 20 2.73 16.39 1 12C2.73 7.61 7 4 12 4C13.83 4 15.5 4.5 16.94 5.36L17.94 4.36M19.07 3.07L20.07 2.07M1 1L5.94 5.94M22 22L17.06 17.06" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                        <path d="M9.9 4.24A9.12 9.12 0 0 1 12 4C17 4 21.27 7.61 23 12C22.19 14.11 20.79 15.85 19.07 17.07L9.9 4.24Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                        <path d="M14.1 19.76A9.12 9.12 0 0 1 12 20C7 20 2.73 16.39 1 12C1.81 9.89 3.21 8.15 4.93 6.93L14.1 19.76Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                    </svg>
                                }
                            </button>
                        </div>
                        @if (!string.IsNullOrWhiteSpace(passwordData.ConfirmPassword) && HasPasswordMismatch())
                        {
                            <div class="password-validation-message">
                                Passwords do not match
                            </div>
                        }
                        @if (!string.IsNullOrWhiteSpace(passwordData.ConfirmPassword) && !HasPasswordMismatch() && !string.IsNullOrWhiteSpace(passwordData.NewPassword))
                        {
                            <div class="password-validation-message success">
                                Passwords match
                            </div>
                        }
                    </div>

                    <div class="password-modal-actions">
                        <button type="button" class="password-cancel-btn" @onclick="ClosePasswordModal">
                            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                <path d="M18 6L6 18M6 6L18 18" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                            </svg>
                            <span>Cancel</span>
                        </button>
                        <button type="submit" class="password-change-btn" disabled="@(!IsPasswordFormValid())">
                            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                <path d="M19 11H5C3.89543 11 3 11.8954 3 13V20C3 21.1046 3.89543 22 5 22H19C20.1046 22 21 21.1046 21 20V13C21 11.8954 20.1046 11 19 11Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                <path d="M7 11V7C7 5.67392 7.52678 4.40215 8.46447 3.46447C9.40215 2.52678 10.6739 2 12 2C13.3261 2 14.5979 2.52678 15.5355 3.46447C16.4732 4.40215 17 5.67392 17 7V11" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                            </svg>
                            <span>Change Password</span>
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>
}

<style>
    .settings-page {
        padding: 4rem;
        min-height: calc(100vh - 150px);
        font-family: 'Montserrat', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
        background: transparent;
        position: relative;
    }

    .settings-header-container {
        background: rgba(255, 255, 255, 0.15);
        backdrop-filter: blur(2px);
        -webkit-backdrop-filter: blur(2px);
        border-radius: 12px;
        padding: 1.5rem 2rem;
        border: 1px solid rgba(0, 0, 0, 0.08);
        box-shadow: 0 1px 3px rgba(0, 0, 0, 0.08);
        margin-bottom: 2rem;
    }

    .settings-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
    }

    .settings-header-left {
        flex: 1;
    }

    .back-link {
        display: inline-flex;
        align-items: center;
        gap: 0.5rem;
        color: #4994FF;
        text-decoration: none;
        font-size: 14px;
        font-weight: 500;
        margin-bottom: 1rem;
        transition: color 0.2s ease;
    }

    .back-link:hover {
        color: #357abd;
    }

    .back-link svg {
        width: 16px;
        height: 16px;
    }

    .settings-title {
        font-size: 32px;
        font-weight: 700;
        color: #111827;
        margin: 0;
    }

    .settings-section {
        background: rgba(255, 255, 255, 0.15);
        backdrop-filter: blur(2px);
        -webkit-backdrop-filter: blur(2px);
        border-radius: 12px;
        padding: 2rem;
        border: 1px solid rgba(0, 0, 0, 0.08);
        box-shadow: 0 1px 3px rgba(0, 0, 0, 0.08);
        margin-bottom: 1.5rem;
    }

    .section-title {
        font-size: 20px;
        font-weight: 600;
        color: #111827;
        margin: 0 0 1.5rem 0;
    }

    .section-description {
        font-size: 14px;
        color: #6b7280;
        margin: 0 0 1.5rem 0;
    }

    .profile-avatar-section {
        display: flex;
        align-items: center;
        gap: 1rem;
        margin-top: 0.5rem;
    }

    .avatar-placeholder {
        width: 80px;
        height: 80px;
        border-radius: 50%;
        background: #E0F2FE;
        border: 2px solid #BAE6FD;
        display: flex;
        align-items: center;
        justify-content: center;
        flex-shrink: 0;
    }

    .avatar-icon {
        width: 32px;
        height: 32px;
        color: #0EA5E9;
    }

    .upload-btn {
        padding: 0.75rem 1.5rem;
        background: #4994FF;
        color: white;
        border: none;
        border-radius: 8px;
        font-size: 14px;
        font-weight: 500;
        cursor: pointer;
        transition: all 0.3s ease;
        font-family: 'Montserrat', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
    }

    .upload-btn:hover {
        background: #357abd;
    }

    .form-group {
        margin-bottom: 1.5rem;
    }

    .form-group:last-child {
        margin-bottom: 0;
    }

    .form-label {
        display: block;
        font-size: 14px;
        font-weight: 500;
        color: #111827;
        margin-bottom: 0.5rem;
    }

    .form-input {
        width: 100%;
        padding: 0.75rem 1rem;
        border: 1px solid #e5e7eb;
        border-radius: 8px;
        font-size: 14px;
        font-family: 'Montserrat', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
        transition: all 0.3s ease;
    }

    .form-input:focus {
        outline: none;
        border-color: #4994FF;
        box-shadow: 0 0 0 3px rgba(74, 144, 255, 0.1);
    }

    .form-textarea {
        width: 100%;
        padding: 0.75rem 1rem;
        border: 1px solid #e5e7eb;
        border-radius: 8px;
        font-size: 14px;
        font-family: 'Montserrat', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
        transition: all 0.3s ease;
        resize: vertical;
        min-height: 100px;
    }

    .form-textarea:focus {
        outline: none;
        border-color: #4994FF;
        box-shadow: 0 0 0 3px rgba(74, 144, 255, 0.1);
    }

    .map-location-container {
        position: relative;
        display: flex;
        align-items: center;
    }

    .map-location-container .form-input {
        padding-right: 3rem;
    }

    .map-location-btn {
        position: absolute;
        right: 0.75rem;
        background: transparent;
        border: none;
        cursor: pointer;
        color: #4994FF;
        display: inline-flex;
        align-items: center;
        justify-content: center;
        padding: 0.25rem;
        transition: all 0.2s ease;
        border-radius: 4px;
    }

    .map-location-btn:hover {
        background: #EFF6FF;
        color: #357abd;
    }

    .map-location-btn svg {
        width: 20px;
        height: 20px;
    }

    /* Profile Accordion Styles */
    .profile-accordion {
        margin-top: 1rem;
        border-top: 1px solid #E5E7EB;
        padding-top: 1.5rem;
    }

    .accordion-header {
        width: 100%;
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 0.75rem 0;
        background: transparent;
        border: none;
        cursor: pointer;
        transition: all 0.2s ease;
        font-family: 'Montserrat', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
    }

    .accordion-header:hover {
        opacity: 0.8;
    }

    .accordion-title {
        font-size: 16px;
        font-weight: 600;
        color: #111827;
    }

    .accordion-icon {
        width: 20px;
        height: 20px;
        color: #6B7280;
        transition: transform 0.3s ease;
        flex-shrink: 0;
    }

    .accordion-icon.expanded {
        transform: rotate(180deg);
    }

    .accordion-content {
        padding-top: 1rem;
        animation: slideDown 0.3s ease;
    }

    @@keyframes slideDown {
        from {
            opacity: 0;
            transform: translateY(-10px);
        }
        to {
            opacity: 1;
            transform: translateY(0);
        }
    }

    .security-item {
        margin-bottom: 2rem;
    }

    .security-item:last-child {
        margin-bottom: 0;
    }

    .security-item .form-label {
        margin-bottom: 0.75rem;
    }

    .security-content {
        display: flex;
        justify-content: space-between;
        align-items: flex-start;
        gap: 2rem;
    }

    .security-description {
        flex: 1;
        font-size: 14px;
        color: #6b7280;
        margin: 0;
        line-height: 1.5;
    }

    .set-password-btn {
        padding: 0.75rem 1.5rem;
        background: #4994FF;
        color: white;
        border: none;
        border-radius: 8px;
        font-size: 14px;
        font-weight: 500;
        cursor: pointer;
        transition: all 0.3s ease;
        font-family: 'Montserrat', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
        white-space: nowrap;
    }

    .set-password-btn:hover {
        background: #357abd;
    }

    .toggle-switch {
        position: relative;
        display: inline-block;
        width: 48px;
        height: 24px;
        flex-shrink: 0;
    }

    .toggle-switch input {
        opacity: 0;
        width: 0;
        height: 0;
    }

    .toggle-slider {
        position: absolute;
        cursor: pointer;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background-color: #d1d5db;
        transition: 0.3s;
        border-radius: 24px;
    }

    .toggle-slider:before {
        position: absolute;
        content: "";
        height: 18px;
        width: 18px;
        left: 3px;
        bottom: 3px;
        background-color: white;
        transition: 0.3s;
        border-radius: 50%;
    }

    .toggle-switch input:checked + .toggle-slider {
        background-color: #4994FF;
    }

    .toggle-switch input:checked + .toggle-slider:before {
        transform: translateX(24px);
    }

    .connected-account-item {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 1rem;
        background: #f9fafb;
        border-radius: 8px;
        border: 1px solid #e5e7eb;
    }

    .account-info {
        display: flex;
        align-items: center;
        gap: 1rem;
    }

    .account-logo {
        width: 40px;
        height: 40px;
        display: flex;
        align-items: center;
        justify-content: center;
        flex-shrink: 0;
    }

    .account-details {
        display: flex;
        flex-direction: column;
        gap: 0.25rem;
    }

    .account-name {
        font-size: 16px;
        font-weight: 500;
        color: #111827;
    }

    .account-status {
        font-size: 14px;
        color: #4994FF;
        font-weight: 500;
    }

    .disconnect-btn {
        padding: 0.5rem 1rem;
        background: transparent;
        color: #6b7280;
        border: 1px solid #e5e7eb;
        border-radius: 8px;
        font-size: 14px;
        font-weight: 500;
        cursor: pointer;
        transition: all 0.3s ease;
        font-family: 'Montserrat', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
    }

    .disconnect-btn:hover {
        background: #f9fafb;
        border-color: #d1d5db;
    }

    .sessions-header {
        display: flex;
        justify-content: space-between;
        align-items: flex-start;
        margin-bottom: 1.5rem;
    }

    .sessions-header-left {
        flex: 1;
    }

    .info-text {
        display: flex;
        align-items: center;
        gap: 0.5rem;
        font-size: 14px;
        color: #6b7280;
        margin-top: 0.5rem;
    }

    .info-icon {
        width: 16px;
        height: 16px;
        color: #6b7280;
        flex-shrink: 0;
    }

    .device-count {
        font-size: 14px;
        font-weight: 500;
        color: #111827;
    }

    .devices-table-container {
        overflow-x: auto;
    }

    .devices-table {
        width: 100%;
        border-collapse: collapse;
    }

    .devices-table thead {
        background: #f9fafb;
    }

    .devices-table th {
        padding: 0.75rem 1rem;
        text-align: left;
        font-size: 14px;
        font-weight: 600;
        color: #111827;
        border-bottom: 1px solid #e5e7eb;
    }

    .devices-table td {
        padding: 1rem;
        font-size: 14px;
        color: #374151;
        border-bottom: 1px solid #e5e7eb;
    }

    .devices-table tbody tr:last-child td {
        border-bottom: none;
    }

    .current-device-badge {
        color: #10B981;
        font-weight: 500;
    }

    .delete-device-btn {
        background: transparent;
        border: none;
        color: #EF4444;
        cursor: pointer;
        padding: 0.5rem;
        display: flex;
        align-items: center;
        justify-content: center;
        transition: color 0.2s ease;
    }

    .delete-device-btn:hover {
        color: #DC2626;
    }

    .delete-device-btn svg {
        width: 18px;
        height: 18px;
    }

    .delete-account-section {
        border: 1.5px solid #FFC9C9;
    }

    .delete-account-btn {
        width: 200px;
        height: 40px;
        padding: 0;
        background: #ffffff;
        color: #9ca3af;
        border: 1px solid #e5e7eb;
        border-radius: 10px;
        font-size: 14px;
        font-weight: 500;
        cursor: not-allowed;
        font-family: 'Montserrat', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
        margin-bottom: 0.75rem;
    }

    .delete-account-note {
        font-size: 14px;
        color: #6b7280;
        margin: 0;
        line-height: 1.5;
        font-weight: 700;
    }

    .support-link {
        color: #4994FF;
        text-decoration: none;
    }

    .support-link:hover {
        text-decoration: underline;
    }

    /* Password Modal Styles */
    .password-modal-backdrop {
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: rgba(15, 23, 42, 0.35);
        backdrop-filter: blur(4px);
        -webkit-backdrop-filter: blur(4px);
        z-index: 9999;
        display: flex;
        align-items: center;
        justify-content: center;
        padding: 1rem;
    }

    .password-modal {
        background: #ffffff;
        border-radius: 16px;
        width: 100%;
        max-width: 500px;
        max-height: 90vh;
        overflow-y: auto;
        box-shadow: 0 24px 60px rgba(15, 23, 42, 0.35);
        border: 1px solid #E5E7EB;
        font-family: 'Montserrat', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
    }

    .password-modal-header {
        display: flex;
        align-items: center;
        justify-content: space-between;
        padding: 1.5rem 1.5rem 1rem 1.5rem;
        border-bottom: 1px solid #E5E7EB;
    }

    .password-modal-title {
        font-size: 24px;
        font-weight: 700;
        color: #111827;
        margin: 0;
    }

    .password-modal-close {
        background: transparent;
        border: none;
        padding: 0.25rem;
        cursor: pointer;
        color: #6B7280;
        display: inline-flex;
        align-items: center;
        justify-content: center;
        border-radius: 999px;
        transition: background 0.15s ease, color 0.15s ease;
    }

    .password-modal-close:hover {
        background: #F3F4F6;
        color: #111827;
    }

    .password-modal-body {
        padding: 1.5rem;
    }

    .password-disclaimer {
        background: #EFF6FF;
        border-left: 4px solid #4994FF;
        padding: 1rem 1.25rem;
        border-radius: 8px;
        margin-bottom: 1.5rem;
    }

    .password-disclaimer-text {
        font-size: 14px;
        color: #111827;
        margin: 0;
        line-height: 1.5;
    }

    .password-form {
        display: flex;
        flex-direction: column;
        gap: 1.25rem;
    }

    .password-form-group {
        display: flex;
        flex-direction: column;
        gap: 0.5rem;
    }

    .password-form-label {
        font-size: 14px;
        font-weight: 500;
        color: #111827;
    }

    .required-asterisk {
        color: #EF4444;
    }

    .password-input-wrapper {
        position: relative;
        display: flex;
        align-items: center;
        border-radius: 8px;
        border: 1px solid #E5E7EB;
        background: #F9FAFB;
        transition: all 0.3s ease;
    }

    .password-input-wrapper:focus-within {
        border-color: #4994FF;
        box-shadow: 0 0 0 3px rgba(73, 148, 255, 0.1);
        background: #FFFFFF;
    }

    .password-form-input {
        width: 100%;
        padding: 0.75rem 2.75rem 0.75rem 1rem;
        border: none;
        border-radius: 8px;
        font-size: 14px;
        font-family: 'Montserrat', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
        transition: all 0.3s ease;
        background: transparent;
        outline: none;
    }

    .password-input-wrapper.invalid {
        border-color: #EF4444;
        background: #FFFFFF;
    }

    .password-input-wrapper.invalid:focus-within {
        border-color: #EF4444;
        box-shadow: 0 0 0 3px rgba(239, 68, 68, 0.1);
    }

    .password-validation-list {
        margin-top: 0.75rem;
        display: flex;
        flex-direction: column;
        gap: 0.5rem;
    }

    .password-validation-item {
        display: flex;
        align-items: center;
        gap: 0.5rem;
        font-size: 13px;
        transition: color 0.2s ease;
    }

    .password-validation-item.valid {
        color: #10B981;
    }

    .password-validation-item.invalid {
        color: #6B7280;
    }

    .password-validation-item svg {
        width: 16px;
        height: 16px;
        flex-shrink: 0;
    }

    .password-validation-item.valid svg {
        color: #10B981;
    }

    .password-validation-item.invalid svg {
        color: #9CA3AF;
    }

    .password-validation-message {
        margin-top: 0.5rem;
        font-size: 13px;
        color: #EF4444;
    }

    .password-validation-message.success {
        color: #10B981;
    }

    .password-toggle-btn {
        position: absolute;
        right: 0.75rem;
        background: transparent;
        border: none;
        cursor: pointer;
        color: #6B7280;
        display: inline-flex;
        align-items: center;
        justify-content: center;
        padding: 0.25rem;
        transition: color 0.15s ease;
    }

    .password-toggle-btn:hover {
        color: #111827;
    }

    .password-modal-actions {
        display: flex;
        gap: 0.75rem;
        justify-content: flex-end;
        margin-top: 0.5rem;
    }

    .password-cancel-btn {
        display: inline-flex;
        align-items: center;
        gap: 0.5rem;
        padding: 0.75rem 1.5rem;
        background: #F3F4F6;
        color: #374151;
        border: none;
        border-radius: 8px;
        font-size: 14px;
        font-weight: 500;
        cursor: pointer;
        transition: all 0.3s ease;
        font-family: 'Montserrat', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
    }

    .password-cancel-btn:hover {
        background: #E5E7EB;
    }

    .password-change-btn {
        display: inline-flex;
        align-items: center;
        gap: 0.5rem;
        padding: 0.75rem 1.5rem;
        background: #4994FF;
        color: white;
        border: none;
        border-radius: 8px;
        font-size: 14px;
        font-weight: 500;
        cursor: pointer;
        transition: all 0.3s ease;
        font-family: 'Montserrat', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
    }

    .password-change-btn:hover:not(:disabled) {
        background: #357abd;
    }

    .password-change-btn:disabled {
        background: #9CA3AF;
        cursor: not-allowed;
        opacity: 0.6;
    }

    @@media (max-width: 768px) {
        .settings-page {
            padding: 0.75rem 0.75rem;
            min-height: auto;
            height: calc(100vh - 150px);
            max-height: calc(100vh - 150px);
            overflow-y: auto;
            overflow-x: hidden;
        }

        .settings-header-container {
            padding: 0.75rem 1rem;
            margin-bottom: 1rem;
        }

        .settings-title {
            font-size: 20px;
        }

        .settings-section {
            padding: 1rem;
            margin-bottom: 1rem;
        }

        .section-title {
            font-size: 16px;
            margin-bottom: 1rem;
        }

        .form-group {
            margin-bottom: 1rem;
        }

        .form-label {
            font-size: 12px;
            margin-bottom: 0.375rem;
        }

        .form-input {
            padding: 0.625rem 0.875rem;
            font-size: 12px;
        }

        .form-textarea {
            padding: 0.625rem 0.875rem;
            font-size: 12px;
            min-height: 80px;
        }

        .map-location-btn {
            right: 0.625rem;
        }

        .map-location-btn svg {
            width: 18px;
            height: 18px;
        }

        .profile-avatar-section {
            gap: 0.75rem;
            margin-top: 0.375rem;
        }

        .avatar-placeholder {
            width: 60px;
            height: 60px;
        }

        .avatar-icon {
            width: 24px;
            height: 24px;
        }

        .upload-btn {
            padding: 0.625rem 1.25rem;
            font-size: 12px;
        }

        .security-item {
            margin-bottom: 1.5rem;
        }

        .security-content {
            flex-direction: column;
            gap: 0.75rem;
        }

        .security-description {
            font-size: 12px;
        }

        .set-password-btn {
            padding: 0.625rem 1.25rem;
            font-size: 12px;
            width: 100%;
        }

        .toggle-switch {
            width: 40px;
            height: 20px;
        }

        .toggle-slider:before {
            height: 14px;
            width: 14px;
            left: 3px;
            bottom: 3px;
        }

        .toggle-switch input:checked + .toggle-slider:before {
            transform: translateX(20px);
        }

        .connected-account-item {
            padding: 0.75rem;
        }

        .account-logo {
            width: 32px;
            height: 32px;
        }

        .account-name {
            font-size: 14px;
        }

        .account-status {
            font-size: 12px;
        }

        .disconnect-btn {
            padding: 0.375rem 0.875rem;
            font-size: 12px;
        }

        .sessions-header {
            flex-direction: column;
            gap: 0.75rem;
            margin-bottom: 1rem;
        }

        .info-text {
            font-size: 12px;
            margin-top: 0.375rem;
        }

        .device-count {
            font-size: 12px;
        }

        .devices-table {
            font-size: 11px;
        }

        .devices-table th,
        .devices-table td {
            padding: 0.5rem 0.375rem;
        }

        .devices-table th {
            font-size: 11px;
        }

        .delete-account-section {
            padding: 1rem;
        }

        .delete-account-btn {
            width: 100%;
            height: 36px;
            font-size: 12px;
            margin-bottom: 0.5rem;
        }

        .delete-account-note {
            font-size: 11px;
        }

        .password-modal {
            max-width: 100%;
            border-radius: 12px;
        }

        .password-modal-header {
            padding: 1rem 1rem 0.75rem 1rem;
        }

        .password-modal-title {
            font-size: 20px;
        }

        .password-modal-body {
            padding: 1rem;
        }

        .password-disclaimer {
            padding: 0.875rem 1rem;
            margin-bottom: 1.25rem;
        }

        .password-disclaimer-text {
            font-size: 13px;
        }

        .password-form {
            gap: 1rem;
        }

        .password-form-label {
            font-size: 13px;
        }

        .password-form-input {
            padding: 0.625rem 2.5rem 0.625rem 0.875rem;
            font-size: 13px;
        }

        .password-toggle-btn {
            right: 0.625rem;
        }

        .password-modal-actions {
            flex-direction: column-reverse;
            gap: 0.625rem;
        }

        .password-cancel-btn,
        .password-change-btn {
            width: 100%;
            justify-content: center;
            padding: 0.625rem 1.25rem;
            font-size: 13px;
        }

        .password-validation-list {
            margin-top: 0.625rem;
            gap: 0.375rem;
        }

        .password-validation-item {
            font-size: 12px;
        }

        .password-validation-item svg {
            width: 14px;
            height: 14px;
        }

        .password-validation-message {
            font-size: 12px;
            margin-top: 0.375rem;
        }

        .profile-accordion {
            margin-top: 0.75rem;
            padding-top: 1rem;
        }

        .accordion-header {
            padding: 0.5rem 0;
        }

        .accordion-title {
            font-size: 14px;
        }

        .accordion-icon {
            width: 18px;
            height: 18px;
        }

        .accordion-content {
            padding-top: 0.75rem;
        }
    }
</style>

@code {
    private class ProfileData
    {
        public string Name { get; set; } = "";
        public string Email { get; set; } = "omarmohamed@gmail.com";
        public string PhoneNumber { get; set; } = "";
        public string Username { get; set; } = "omarmohamedl";
        public string Speciality { get; set; } = "";
        public string ProfessionalTitle { get; set; } = "";
        public string Organization { get; set; } = "";
        public string Address { get; set; } = "";
        public string MapLocation { get; set; } = "";
        public string About { get; set; } = "";
        public bool TwoFactorEnabled { get; set; } = false;
    }

    private class ConnectedDevice
    {
        public string OS { get; set; } = "";
        public string Browser { get; set; } = "";
        public string Location { get; set; } = "";
        public string LastSession { get; set; } = "";
        public bool IsCurrentDevice { get; set; }
    }

    private ProfileData profileData = new();
    private int maxDevices = 3;
    private bool isPasswordModalOpen = false;
    private bool showCurrentPassword = false;
    private bool showNewPassword = false;
    private bool showConfirmPassword = false;
    private bool isAdditionalFieldsExpanded = false;

    private class PasswordData
    {
        public string CurrentPassword { get; set; } = "";
        public string NewPassword { get; set; } = "";
        public string ConfirmPassword { get; set; } = "";
    }

    private PasswordData passwordData = new();

    private List<ConnectedDevice> connectedDevices = new()
    {
        new ConnectedDevice
        {
            OS = "Windows 10",
            Browser = "Edge 144",
            Location = "185.107.28.53",
            LastSession = "â€¢ This device",
            IsCurrentDevice = true
        },
        new ConnectedDevice
        {
            OS = "Windows 10",
            Browser = "Chrome 134",
            Location = "176.87.229.168",
            LastSession = "2 hours ago",
            IsCurrentDevice = false
        },
        new ConnectedDevice
        {
            OS = "Windows 10",
            Browser = "Chrome 134",
            Location = "176.87.229.168",
            LastSession = "2 hours ago",
            IsCurrentDevice = false
        }
    };

    private void HandleUploadAvatar()
    {
        // TODO: Implement avatar upload functionality
        Console.WriteLine("Upload avatar clicked");
    }

    private void HandleSetPassword()
    {
        isPasswordModalOpen = true;
        passwordData = new PasswordData();
        showCurrentPassword = false;
        showNewPassword = false;
        showConfirmPassword = false;
    }

    private void ClosePasswordModal()
    {
        isPasswordModalOpen = false;
        passwordData = new PasswordData();
        showCurrentPassword = false;
        showNewPassword = false;
        showConfirmPassword = false;
    }

    private async Task HandleChangePassword()
    {
        // Validate passwords match
        if (passwordData.NewPassword != passwordData.ConfirmPassword)
        {
            // TODO: Show error message - passwords don't match
            Console.WriteLine("Passwords do not match");
            return;
        }

        // TODO: Implement password change API call
        // Example:
        // var response = await Http.PostAsJsonAsync("/api/auth/change-password", passwordData);
        // if (response.IsSuccessStatusCode)
        // {
        //     ClosePasswordModal();
        //     // Show success message
        // }

        Console.WriteLine("Change password submitted");
        ClosePasswordModal();
    }

    private void HandleDisconnectGoogle()
    {
        // TODO: Implement Google account disconnect
        Console.WriteLine("Disconnect Google clicked");
    }

    private void HandleDeleteDevice(ConnectedDevice device)
    {
        // TODO: Implement device deletion
        connectedDevices.Remove(device);
        StateHasChanged();
    }

    private void OpenMapPicker()
    {
        // TODO: Implement map picker modal or integration with map service
        Console.WriteLine("Open map picker clicked");
    }

    private void ToggleAdditionalFields()
    {
        isAdditionalFieldsExpanded = !isAdditionalFieldsExpanded;
    }

    // Password validation methods
    private bool HasMinLength()
    {
        return !string.IsNullOrWhiteSpace(passwordData.NewPassword) && passwordData.NewPassword.Length >= 8;
    }

    private bool HasCapitalLetter()
    {
        return !string.IsNullOrWhiteSpace(passwordData.NewPassword) && passwordData.NewPassword.Any(char.IsUpper);
    }

    private bool HasSpecialCharacter()
    {
        if (string.IsNullOrWhiteSpace(passwordData.NewPassword))
            return false;
        
        var specialChars = "!@#$%^&*()_+-=[]{}|;:,.<>?";
        return passwordData.NewPassword.Any(c => specialChars.Contains(c));
    }

    private bool HasNewPasswordErrors()
    {
        if (string.IsNullOrWhiteSpace(passwordData.NewPassword))
            return false;
        
        return !HasMinLength() || !HasCapitalLetter() || !HasSpecialCharacter();
    }

    private bool HasPasswordMismatch()
    {
        if (string.IsNullOrWhiteSpace(passwordData.ConfirmPassword))
            return false;
        
        return passwordData.NewPassword != passwordData.ConfirmPassword;
    }

    private bool IsNewPasswordSameAsCurrent()
    {
        if (string.IsNullOrWhiteSpace(passwordData.NewPassword) || string.IsNullOrWhiteSpace(passwordData.CurrentPassword))
            return false;
        
        return passwordData.NewPassword.Equals(passwordData.CurrentPassword, StringComparison.Ordinal);
    }

    private bool DoPasswordsMatch()
    {
        if (string.IsNullOrWhiteSpace(passwordData.NewPassword) || string.IsNullOrWhiteSpace(passwordData.ConfirmPassword))
            return false;
        
        return passwordData.NewPassword == passwordData.ConfirmPassword;
    }

    private bool IsPasswordFormValid()
    {
        // Check if current password is provided
        if (string.IsNullOrWhiteSpace(passwordData.CurrentPassword))
            return false;
        
        // Check if new password is not the same as current password
        if (IsNewPasswordSameAsCurrent())
            return false;
        
        // Check if new password meets all requirements
        if (!HasMinLength() || !HasCapitalLetter() || !HasSpecialCharacter())
            return false;
        
        // Check if confirm password is provided
        if (string.IsNullOrWhiteSpace(passwordData.ConfirmPassword))
            return false;
        
        // Check if passwords match
        if (!DoPasswordsMatch())
            return false;
        
        return true;
    }
}
